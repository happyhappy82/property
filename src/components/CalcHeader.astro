---
const categories = [
  {
    name: '세금',
    items: [
      { title: '취득세', href: '/calculators/acquisition-tax' },
      { title: '양도소득세', href: '/calculators/transfer-tax' },
      { title: '재산세', href: '/calculators/property-tax' },
      { title: '종합부동산세', href: '/calculators/comprehensive-tax' },
      { title: '보유세 통합', href: '/calculators/holding-tax' },
      { title: '증여세', href: '/calculators/gift-tax' },
      { title: '상속세', href: '/calculators/inheritance-tax' },
      { title: '종합소득세', href: '/calculators/income-tax' },
      { title: '임대소득세', href: '/calculators/rental-income-tax' },
      { title: '인지세', href: '/calculators/stamp-tax' },
      { title: '지역자원시설세', href: '/calculators/regional-tax' },
      { title: '누진세', href: '/calculators/progressive-tax' },
      { title: '건물분 부가세', href: '/calculators/building-vat' },
      { title: '착한 임대인', href: '/calculators/good-landlord' },
    ]
  },
  {
    name: '대출',
    items: [
      { title: '대출/상환', href: '/calculators/loan' },
      { title: 'DSR', href: '/calculators/dsr' },
      { title: 'DTI', href: '/calculators/dti' },
      { title: 'LTV', href: '/calculators/ltv' },
      { title: '최대 대출가능액', href: '/calculators/max-loan' },
      { title: '경매 대출', href: '/calculators/foreclosure-loan' },
      { title: '장래소득', href: '/calculators/future-income' },
      { title: '중도상환수수료', href: '/calculators/early-repayment' },
      { title: '연체이자', href: '/calculators/overdue-interest' },
      { title: '예적금 이자', href: '/calculators/savings-interest' },
    ]
  },
  {
    name: '임대차',
    items: [
      { title: '월세/전세 변환', href: '/calculators/rent-convert' },
      { title: '임대료 인상', href: '/calculators/rent-increase' },
      { title: '임대료 조정', href: '/calculators/rent-adjust' },
      { title: '간주임대료', href: '/calculators/deemed-rental' },
    ]
  },
  {
    name: '투자·수익',
    items: [
      { title: '투자 수익률', href: '/calculators/investment-return' },
      { title: '임대수익률', href: '/calculators/rental-yield' },
      { title: 'RTI', href: '/calculators/rti' },
      { title: '추정소득', href: '/calculators/estimated-income' },
      { title: '재건축 연한', href: '/calculators/reconstruction' },
    ]
  },
  {
    name: '경매',
    items: [
      { title: '경매신청비용', href: '/calculators/auction-cost' },
      { title: '경매배당', href: '/calculators/auction-distribution' },
      { title: '명도비용', href: '/calculators/eviction-cost' },
    ]
  },
  {
    name: '비용·수수료',
    items: [
      { title: '등기비용', href: '/calculators/registration-cost' },
      { title: '법무사 보수', href: '/calculators/attorney-fee' },
      { title: '국민주택채권', href: '/calculators/housing-bond' },
      { title: '감정평가수수료', href: '/calculators/appraisal-fee' },
      { title: '중개수수료', href: '/calculators/brokerage-fee' },
    ]
  },
  {
    name: '건물·분석',
    items: [
      { title: '건폐율/용적률', href: '/calculators/building-ratio' },
      { title: '건물기준시가', href: '/calculators/building-price' },
      { title: '대지지분', href: '/calculators/land-share' },
      { title: '평당가격', href: '/calculators/unit-price' },
      { title: '잔존가치', href: '/calculators/remaining-value' },
    ]
  },
  {
    name: '유틸리티',
    items: [
      { title: '면적변환', href: '/calculators/area-convert' },
      { title: '날짜 계산', href: '/calculators/date-calc' },
      { title: '상속지분', href: '/calculators/inheritance-share' },
    ]
  },
]
---

<header class="calc-header">
  <div class="calc-header-top">
    <a href="/" class="calc-logo">
      <picture>
        <source srcset="/logo.webp" type="image/webp" />
        <img src="/logo.png" alt="부동산 트렌드 리뷰" width="280" height="280" loading="eager" decoding="async" fetchpriority="high" />
      </picture>
    </a>
    <div class="calc-header-actions">
      <a href="/calculators" class="calc-home-link">전체 계산기</a>
      <button id="calc-theme-toggle" class="calc-theme-toggle" aria-label="테마 변경" title="다크모드/라이트모드 전환">
        <svg class="calc-sun-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
        <svg class="calc-moon-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
      </button>
    </div>
  </div>
  <nav class="calc-nav">
    {categories.map((cat) => (
      <div class="calc-nav-group" data-category={cat.name}>
        <button class="calc-nav-trigger" type="button">
          {cat.name}
          <svg class="calc-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 5l3 3 3-3"/></svg>
        </button>
        <div class="calc-dropdown">
          <div class="calc-dropdown-inner">
            {cat.items.map((item) => (
              <a href={item.href} class="calc-dropdown-item">{item.title}</a>
            ))}
          </div>
        </div>
      </div>
    ))}
  </nav>
</header>

<style>
  .calc-header {
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    background: #fff;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 100;
    margin-bottom: 2rem;
  }
  :global(.dark) .calc-header {
    background: #111827;
    border-bottom-color: #374151;
  }

  .calc-header-top {
    max-width: 42rem;
    margin: 0 auto;
    padding: 0.625rem 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .calc-logo { display: inline-block; }
  .calc-logo img { height: 36px; width: auto; }

  .calc-header-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .calc-home-link {
    font-size: 0.8125rem;
    font-weight: 600;
    color: #2563eb;
    text-decoration: none;
    padding: 0.375rem 0.75rem;
    border-radius: 0.375rem;
    border: 1px solid #2563eb;
    transition: background 0.15s, color 0.15s;
  }
  .calc-home-link:hover {
    background: #2563eb;
    color: #fff;
  }
  :global(.dark) .calc-home-link {
    color: #60a5fa;
    border-color: #60a5fa;
  }
  :global(.dark) .calc-home-link:hover {
    background: #60a5fa;
    color: #111827;
  }

  .calc-theme-toggle {
    padding: 0.375rem;
    border-radius: 0.375rem;
    background: none;
    border: none;
    cursor: pointer;
    color: #4b5563;
    transition: background 0.15s;
  }
  .calc-theme-toggle:hover { background: #f3f4f6; }
  :global(.dark) .calc-theme-toggle { color: #9ca3af; }
  :global(.dark) .calc-theme-toggle:hover { background: #1f2937; }
  .calc-theme-toggle svg { width: 1.125rem; height: 1.125rem; }

  /* 다크모드 아이콘 토글 */
  .calc-sun-icon { display: none; }
  .calc-moon-icon { display: block; }
  :global(.dark) .calc-sun-icon { display: block; }
  :global(.dark) .calc-moon-icon { display: none; }

  /* 네비게이션 바 */
  .calc-nav {
    max-width: 42rem;
    margin: 0 auto;
    padding: 0 1.25rem;
    display: flex;
    align-items: center;
    gap: 0;
    overflow: visible;
  }

  .calc-nav-group { position: relative; }

  .calc-nav-trigger {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.625rem 0.875rem;
    font-size: 0.8125rem;
    font-weight: 600;
    color: #374151;
    background: none;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    border-bottom: 2px solid transparent;
    transition: color 0.15s, border-color 0.15s;
  }
  .calc-nav-trigger:hover {
    color: #2563eb;
    border-bottom-color: #2563eb;
  }
  :global(.dark) .calc-nav-trigger { color: #d1d5db; }
  :global(.dark) .calc-nav-trigger:hover {
    color: #60a5fa;
    border-bottom-color: #60a5fa;
  }

  .calc-chevron {
    transition: transform 0.2s;
    flex-shrink: 0;
  }

  /* 드롭다운: hover로 열림 (데스크톱) */
  .calc-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    padding-top: 0.25rem;
    z-index: 200;
  }
  .calc-dropdown-inner {
    min-width: 180px;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    padding: 0.25rem 0;
  }
  :global(.dark) .calc-dropdown-inner {
    background: #1f2937;
    border-color: #374151;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  }

  /* hover OR .open 클래스로 열림 */
  .calc-nav-group:hover > .calc-dropdown,
  .calc-nav-group.open > .calc-dropdown {
    display: block;
  }
  .calc-nav-group:hover > .calc-nav-trigger,
  .calc-nav-group.open > .calc-nav-trigger {
    color: #2563eb;
    border-bottom-color: #2563eb;
  }
  :global(.dark) .calc-nav-group:hover > .calc-nav-trigger,
  :global(.dark) .calc-nav-group.open > .calc-nav-trigger {
    color: #60a5fa;
    border-bottom-color: #60a5fa;
  }
  .calc-nav-group:hover .calc-chevron,
  .calc-nav-group.open .calc-chevron {
    transform: rotate(180deg);
  }

  .calc-dropdown-item {
    display: block;
    padding: 0.5rem 1rem;
    font-size: 0.8125rem;
    color: #374151;
    text-decoration: none;
    white-space: nowrap;
    transition: background 0.1s, color 0.1s;
  }
  .calc-dropdown-item:hover {
    background: #eff6ff;
    color: #2563eb;
  }
  :global(.dark) .calc-dropdown-item { color: #d1d5db; }
  :global(.dark) .calc-dropdown-item:hover {
    background: #1e3a5f;
    color: #60a5fa;
  }

  @media (max-width: 768px) {
    .calc-nav {
      padding: 0 0.75rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .calc-nav::-webkit-scrollbar { display: none; }
    .calc-nav-trigger {
      padding: 0.5rem 0.625rem;
      font-size: 0.75rem;
    }
    .calc-dropdown {
      position: fixed;
      left: 0;
      right: 0;
      top: auto;
      padding-top: 0;
    }
    .calc-dropdown-inner {
      min-width: auto;
      border-radius: 0;
      max-height: 50vh;
      overflow-y: auto;
    }
    .calc-dropdown-item { padding: 0.75rem 1.25rem; }
  }
</style>

<script>
  // 즉시 실행 (Astro는 DOMContentLoaded가 이미 지난 후 스크립트를 로드할 수 있음)
  (function() {
    // 테마 토글
    const toggle = document.getElementById('calc-theme-toggle');
    toggle?.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // 클릭으로 드롭다운 토글 (모바일 + 데스크톱 모두 지원)
    document.querySelectorAll('.calc-nav-trigger').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const group = (e.currentTarget as HTMLElement).parentElement;
        if (!group) return;
        const isOpen = group.classList.contains('open');
        // 다른 그룹 닫기
        document.querySelectorAll('.calc-nav-group.open').forEach(g => g.classList.remove('open'));
        if (!isOpen) group.classList.add('open');
      });
    });

    // 외부 클릭 시 닫기
    document.addEventListener('click', (e) => {
      if (!(e.target as HTMLElement).closest('.calc-nav-group')) {
        document.querySelectorAll('.calc-nav-group.open').forEach(g => g.classList.remove('open'));
      }
    });
  })();
</script>
