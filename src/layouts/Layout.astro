---
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  ogImage?: string;
  article?: {
    publishedTime: string;
    modifiedTime: string;
  };
}

const baseUrl = "https://www.budongsantrendreview.xyz";
const siteName = "부동산 트렌드 리뷰";
const defaultDescription = "부동산 관련 트렌드와 정책 등 다양한 부동산 정보들을 떠먹여드립니다. 꿀팁받아가세요!!";

const {
  title = siteName,
  description = defaultDescription,
  canonical = baseUrl,
  ogImage = "/opengraph-image.png",
  article,
} = Astro.props;

const fullTitle = title === siteName ? title : `${title} | ${siteName}`;

const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: siteName,
  alternateName: "PropertyReviewLab",
  url: baseUrl,
  description: defaultDescription,
  inLanguage: "ko-KR",
  potentialAction: {
    "@type": "SearchAction",
    target: {
      "@type": "EntryPoint",
      urlTemplate: `${baseUrl}/?q={search_term_string}`,
    },
    "query-input": "required name=search_term_string",
  },
};

const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: siteName,
  alternateName: "PropertyReviewLab",
  url: baseUrl,
  logo: {
    "@type": "ImageObject",
    url: `${baseUrl}/logo.png`,
    width: 200,
    height: 50,
  },
  description: defaultDescription,
  foundingDate: "2024",
  sameAs: [],
};
---

<!doctype html>
<html lang="ko" class="">
  <head>
    <!-- Theme initialization (must run before body renders to prevent FOUC) -->
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />

    <!-- Critical CSS inline for faster LCP -->
    <style>
      body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;margin:0 auto;max-width:42rem;padding:3rem 1.25rem;background:#fff;color:#000;transition:background-color .2s,color .2s}
      html.dark body{background:#111827;color:#f3f4f6}
      h1,h2,h3,h4{scroll-margin-top:80px}
      .text-\[42px\]{font-size:42px}.text-\[28px\]{font-size:28px}.font-black{font-weight:900}.leading-tight{line-height:1.25}.mb-4{margin-bottom:1rem}.mb-2{margin-bottom:0.5rem}.mb-8{margin-bottom:2rem}.mb-14{margin-bottom:3.5rem}
      .text-gray-900{color:#111827}.text-gray-700{color:#374151}.text-gray-600{color:#4b5563}.text-gray-500{color:#6b7280}.text-sm{font-size:.875rem;line-height:1.25rem}
      html.dark .text-gray-900{color:#f3f4f6}html.dark .text-gray-700{color:#d1d5db}html.dark .text-gray-600{color:#9ca3af}html.dark .text-gray-500{color:#9ca3af}
      .flex{display:flex}.gap-4{gap:1rem}.gap-8{gap:2rem}.flex-col{flex-direction:column}.items-center{align-items:center}.gap-2{gap:.5rem}
      header{margin-bottom:3.5rem;display:flex;justify-content:space-between;align-items:center}
      a{color:inherit;text-decoration:none}
      nav{margin-bottom:1rem}
      main{display:block}
      article{position:relative}
      .prose{color:#374151;max-width:65ch;font-size:1.125rem;line-height:1.75}
      html.dark .prose{color:#d1d5db}
      .prose p{margin-top:1.25em;margin-bottom:1.25em}
      .prose h2{color:#111827;font-weight:700;font-size:1.5em;margin-top:2em;margin-bottom:1em;line-height:1.33}
      .prose h3{color:#111827;font-weight:600;font-size:1.25em;margin-top:1.6em;margin-bottom:.6em;line-height:1.6}
      .prose strong{color:#111827;font-weight:600}
      html.dark .prose h2,html.dark .prose h3,html.dark .prose strong{color:#f3f4f6}
      .prose a{color:#2563eb;text-decoration:underline;font-weight:500}
      html.dark .prose a{color:#60a5fa}
      .prose ul,.prose ol{margin-top:1.25em;margin-bottom:1.25em;padding-left:1.625em}
      .prose li{margin-top:.5em;margin-bottom:.5em}
      .prose-lg{font-size:1.125rem;line-height:1.78}
      .max-w-none{max-width:none}
      .article-content{content-visibility:auto;contain-intrinsic-size:auto 500px}
      .article-content>*:nth-child(n+4){content-visibility:auto;contain-intrinsic-size:auto 100px}
      .theme-toggle{padding:.5rem;border-radius:.5rem;transition:background-color .2s}
      .theme-toggle:hover{background:#f3f4f6}
      html.dark .theme-toggle:hover{background:#1f2937}
      .theme-toggle svg{width:1.25rem;height:1.25rem}
      .hidden{display:none}
    </style>

    <!-- Preload LCP image -->
    <link rel="preload" as="image" type="image/webp" href="/logo.webp" fetchpriority="high" />

    <!-- Preconnect -->
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.google-analytics.com" />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />

    <!-- Favicon -->
    <link rel="icon" type="image/webp" href="/icon.webp" />
    <link rel="icon" type="image/png" href="/icon.png" />
    <link rel="apple-touch-icon" href="/apple-icon.png" />

    <!-- SEO -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1" />
    <meta name="keywords" content="부동산 트렌드,부동산 정책,부동산 정보,부동산 꿀팁,부동산 리뷰" />
    <meta name="author" content={siteName} />
    <meta name="creator" content={siteName} />
    <meta name="publisher" content={siteName} />

    <!-- Verification -->
    <meta name="google-site-verification" content="vi4LbSZZ_4ihh_mi0E487dru0ug1XdS3W3cwSqcjxOk" />
    <meta name="naver-site-verification" content="3dd70351eb08e18e4f93168b339174192e9d84d9" />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content="ko_KR" />
    <meta property="og:type" content={article ? "article" : "website"} />
    <meta property="og:image" content={`${baseUrl}${ogImage}`} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    {article && <meta property="article:published_time" content={article.publishedTime} />}
    {article && <meta property="article:modified_time" content={article.modifiedTime} />}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={`${baseUrl}${ogImage}`} />

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="부동산 트렌드 리뷰 RSS" href="/rss.xml" />

    <!-- Schema.org -->
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />

    <slot name="head" />

    <!-- GTM with Partytown (runs in Web Worker) -->
    <script type="text/partytown" src="https://www.googletagmanager.com/gtag/js?id=G-DWB3TENH1D"></script>
    <script type="text/partytown">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DWB3TENH1D');
    </script>
  </head>
  <body class="mx-auto max-w-2xl px-5 py-12">
    <slot />
  </body>
</html>
