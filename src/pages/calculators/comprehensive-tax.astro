---
import CalcLayout from '../../layouts/CalcLayout.astro'
---
<CalcLayout title="부동산 종합부동산세 계산기" description="고가 주택 보유 시 종합부동산세를 계산하고 절세 방법을 확인하세요.">
    <div class="mb-6">
      <a href="/calculators" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">&larr; 계산기 목록</a>
    </div>

    <h1 class="text-2xl font-bold mb-2 dark:text-white">부동산 종합부동산세 계산기</h1>
    <p class="text-gray-600 dark:text-gray-400 mb-6">부동산 종합부동산세 계산기를 이용하면 공시가격 기준으로 예상 종부세를 빠르게 확인할 수 있습니다. 1세대 1주택 특별공제와 세액공제까지 반영하여 부동산 종합부동산세를 정확하게 산출합니다. 고가 주택 보유자라면 이 계산기로 매년 부과되는 부동산 종합부동산세 부담을 미리 점검해 보세요.</p>

    <!-- 입력 폼 -->
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 mb-6">
      <form id="calc-form" class="space-y-4">
        <div>
          <label for="totalAssessedValue" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            주택 공시가격 합산 (원)
          </label>
          <input
            type="text"
            id="totalAssessedValue"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent"
            placeholder="0"
          />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">보유 주택의 공시가격 합산액</p>
        </div>

        <div>
          <label class="flex items-center">
            <input type="checkbox" id="isSingleHomeOwner" class="mr-2 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-400" />
            <span class="text-sm text-gray-700 dark:text-gray-300">1세대 1주택자</span>
          </label>
        </div>

        <div id="age-field" class="hidden">
          <label for="ownerAge" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            소유자 나이
          </label>
          <input
            type="number"
            id="ownerAge"
            min="0"
            max="120"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent"
            placeholder="0"
          />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">고령자 공제 (60세 이상)</p>
        </div>

        <div id="holding-field" class="hidden">
          <label for="holdingYears" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            보유기간 (년)
          </label>
          <input
            type="number"
            id="holdingYears"
            min="0"
            max="100"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent"
            placeholder="0"
          />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">장기보유 공제 (5년 이상)</p>
        </div>

        <button
          type="submit"
          class="w-full bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition-colors"
        >
          계산하기
        </button>
      </form>
    </div>

    <!-- 에러 메시지 -->
    <div id="error-msg" class="hidden mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
      <p class="text-sm text-red-600 dark:text-red-400"></p>
    </div>

    <!-- 비과세 메시지 -->
    <div id="exempt-msg" class="hidden mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
      <h3 class="text-lg font-bold text-green-900 dark:text-green-100 mb-2">과세 대상 아님</h3>
      <p class="text-sm text-green-700 dark:text-green-300"></p>
    </div>

    <!-- 결과 -->
    <div id="results" class="hidden space-y-4">
      <!-- 요약 -->
      <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
        <h2 class="text-lg font-bold text-blue-900 dark:text-blue-100 mb-4">납부 세액</h2>
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <span class="text-gray-700 dark:text-gray-300">총 납부세액</span>
            <span id="total-tax" class="text-xl font-bold text-blue-900 dark:text-blue-100"></span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-700 dark:text-gray-300">실효세율</span>
            <span id="effective-rate" class="text-lg font-medium text-blue-800 dark:text-blue-200"></span>
          </div>
        </div>
      </div>

      <!-- 과세 기준 -->
      <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
        <h3 class="text-md font-bold text-gray-900 dark:text-white mb-3">과세 기준</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">기본공제</span>
            <span id="basic-deduction" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">과세표준</span>
            <span id="tax-base" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">산출세액</span>
            <span id="calculated-tax" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
        </div>
      </div>

      <!-- 세액공제 (1세대 1주택만) -->
      <div id="deduction-section" class="hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
        <h3 class="text-md font-bold text-gray-900 dark:text-white mb-3">세액공제</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">고령자 공제율</span>
            <span id="age-deduction-rate" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">장기보유 공제율</span>
            <span id="holding-deduction-rate" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">합산 공제율</span>
            <span id="total-deduction-rate" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">세액공제액</span>
            <span id="deduction-amount" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
        </div>
      </div>

      <!-- 세부 내역 -->
      <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
        <h3 class="text-md font-bold text-gray-900 dark:text-white mb-3">세부 내역</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">종합부동산세</span>
            <span id="comprehensive-tax" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">지방교육세 (20%)</span>
            <span id="local-education-tax" class="text-gray-900 dark:text-white font-medium"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- 안내사항 -->
    <div class="mt-8 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700">
      <p class="text-xs text-gray-500 dark:text-gray-400">
        ※ 본 계산기는 참고용이며, 실제 세액은 관할 세무서에 확인하시기 바랍니다.
        1세대 1주택자는 12억 원, 다주택자는 9억 원 기본공제가 적용됩니다.
        고령자 공제(60세 이상)와 장기보유 공제(5년 이상)는 1세대 1주택자에게만 적용되며, 합산 공제율은 최대 80%입니다.
      </p>
    </div>

    <!-- SEO 콘텐츠 섹션 -->
    <article class="mt-12 prose prose-sm dark:prose-invert max-w-none">
      <section class="mb-10">
        <h2 class="text-xl font-bold dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">종합부동산세란?</h2>
        <p class="text-gray-700 dark:text-gray-300 leading-relaxed mb-3">종합부동산세(종부세)는 일정 기준을 초과하는 부동산을 보유한 자에게 부과되는 국세입니다. 매년 6월 1일(과세기준일) 현재 보유한 주택의 공시가격 합산액이 기본공제를 초과하는 경우 과세대상이 됩니다. 1세대 1주택자는 공시가격 12억 원, 다주택자는 9억 원을 초과할 때 종부세가 부과됩니다.</p>
        <p class="text-gray-700 dark:text-gray-300 leading-relaxed">종부세는 매년 12월 1일부터 15일까지 납부하며, 공시가격 합산액에서 기본공제를 차감한 후 공정시장가액비율(60%)을 곱하여 과세표준을 산출합니다. 1세대 1주택자는 고령자 공제(60세 이상)와 장기보유 공제(5년 이상)를 받을 수 있으며, 합산 공제율은 최대 80%까지 적용됩니다.</p>
      </section>

      <section class="mb-10">
        <h2 class="text-xl font-bold dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">종합부동산세 세율표</h2>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse border border-gray-200 dark:border-gray-700">
            <thead>
              <tr class="bg-gray-100 dark:bg-gray-700">
                <th class="border border-gray-200 dark:border-gray-600 px-3 py-2 text-left dark:text-white">과세표준</th>
                <th class="border border-gray-200 dark:border-gray-600 px-3 py-2 text-left dark:text-white">일반 세율 (2주택 이하)</th>
                <th class="border border-gray-200 dark:border-gray-600 px-3 py-2 text-left dark:text-white">3주택 이상·조정지역 2주택</th>
              </tr>
            </thead>
            <tbody class="dark:text-gray-300">
              <tr>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">3억원 이하</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">0.5%</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">0.5%</td>
              </tr>
              <tr class="bg-gray-50 dark:bg-gray-800/50">
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">3억원 ~ 6억원</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">0.7%</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">0.7%</td>
              </tr>
              <tr>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">6억원 ~ 12억원</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">1.0%</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">1.0%</td>
              </tr>
              <tr class="bg-gray-50 dark:bg-gray-800/50">
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">12억원 ~ 25억원</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">1.3%</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">2.0%</td>
              </tr>
              <tr>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">25억원 ~ 50억원</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">1.5%</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">3.0%</td>
              </tr>
              <tr class="bg-gray-50 dark:bg-gray-800/50">
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">50억원 ~ 94억원</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">2.0%</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">4.0%</td>
              </tr>
              <tr>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">94억원 초과</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">2.7%</td>
                <td class="border border-gray-200 dark:border-gray-600 px-3 py-2">5.0%</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-3">※ 세부담상한: 일반 150%, 3주택 이상·조정지역 2주택 300%</p>
      </section>

      <section class="mb-10">
        <h2 class="text-xl font-bold dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">종합부동산세 계산 예시</h2>
        <div class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-5 border border-gray-200 dark:border-gray-700">
          <h3 class="text-base font-semibold dark:text-white mb-3">예시: 1세대 1주택, 공시가격 15억 원</h3>
          <div class="text-sm text-gray-700 dark:text-gray-300 space-y-1.5">
            <p>· 공시가격: 15억 원</p>
            <p>· 기본공제: 12억 원 (1세대 1주택)</p>
            <p>· 과세표준: (15억 - 12억) × 60% = 1억 8,000만 원</p>
            <p>· 세율 적용: 1.8억 × 0.5% = 90만 원</p>
            <p>· 지방교육세 (20%): 18만 원</p>
            <p class="font-semibold dark:text-white mt-3 pt-3 border-t border-gray-200 dark:border-gray-600">· 결과: <span class="text-blue-600 dark:text-blue-400">총 납부세액 약 108만 원 (세액공제 미적용 시)</span></p>
          </div>
        </div>
      </section>

      <section class="mb-10">
        <h2 class="text-xl font-bold dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">종합부동산세 자주 묻는 질문</h2>
        <div class="space-y-4">
          <details class="group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg" open>
            <summary class="flex items-center justify-between cursor-pointer px-4 py-3 font-medium dark:text-white text-sm hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg">
              <span>Q. 종부세 과세기준금액은 얼마인가요?</span>
              <svg class="w-4 h-4 flex-shrink-0 ml-2 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </summary>
            <div class="px-4 pb-3 text-sm text-gray-700 dark:text-gray-300">1세대 1주택자는 공시가격 12억 원, 다주택자(일반)는 공시가격 합산 9억 원을 초과하는 경우 종부세가 부과됩니다. 이 금액 이하라면 종합부동산세 과세대상에 해당하지 않습니다.</div>
          </details>
          <details class="group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg">
            <summary class="flex items-center justify-between cursor-pointer px-4 py-3 font-medium dark:text-white text-sm hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg">
              <span>Q. 세부담상한이란 무엇인가요?</span>
              <svg class="w-4 h-4 flex-shrink-0 ml-2 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </summary>
            <div class="px-4 pb-3 text-sm text-gray-700 dark:text-gray-300">세부담상한은 전년도 대비 종부세가 급격히 증가하는 것을 방지하는 제도입니다. 일반적인 경우 전년도 세액의 150%를 상한으로 하며, 3주택 이상 또는 조정대상지역 2주택의 경우 300%를 상한으로 합니다.</div>
          </details>
          <details class="group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg">
            <summary class="flex items-center justify-between cursor-pointer px-4 py-3 font-medium dark:text-white text-sm hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg">
              <span>Q. 1세대 1주택자 세액공제에는 어떤 것이 있나요?</span>
              <svg class="w-4 h-4 flex-shrink-0 ml-2 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </summary>
            <div class="px-4 pb-3 text-sm text-gray-700 dark:text-gray-300">1세대 1주택자는 고령자 공제(60세 이상 20%, 65세 이상 30%, 70세 이상 40%)와 장기보유 공제(5년 이상 20%, 10년 이상 40%, 15년 이상 50%)를 받을 수 있습니다. 두 공제를 합산한 최대 공제율은 80%입니다.</div>
          </details>
          <details class="group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg">
            <summary class="flex items-center justify-between cursor-pointer px-4 py-3 font-medium dark:text-white text-sm hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg">
              <span>Q. 부부 공동명의 시 종부세는 어떻게 계산되나요?</span>
              <svg class="w-4 h-4 flex-shrink-0 ml-2 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </summary>
            <div class="px-4 pb-3 text-sm text-gray-700 dark:text-gray-300">부부 공동명의의 경우 각각의 지분에 해당하는 공시가격을 기준으로 인별 과세됩니다. 예를 들어 공시가 18억 원 주택을 부부 50:50으로 보유하면 각각 9억 원씩 계산되어 기본공제(9억 원) 이하가 되어 종부세가 부과되지 않을 수 있습니다. 다만, 1세대 1주택 특례(12억 공제 등)는 적용되지 않으므로 유불리를 비교해야 합니다.</div>
          </details>
        </div>
      </section>
    </article>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "종부세 과세기준금액은 얼마인가요?",
          "acceptedAnswer": { "@type": "Answer", "text": "1세대 1주택자는 공시가격 12억 원, 다주택자(일반)는 공시가격 합산 9억 원을 초과하는 경우 종부세가 부과됩니다. 이 금액 이하라면 종합부동산세 과세대상에 해당하지 않습니다." }
        },
        {
          "@type": "Question",
          "name": "세부담상한이란 무엇인가요?",
          "acceptedAnswer": { "@type": "Answer", "text": "세부담상한은 전년도 대비 종부세가 급격히 증가하는 것을 방지하는 제도입니다. 일반적인 경우 전년도 세액의 150%를 상한으로 하며, 3주택 이상 또는 조정대상지역 2주택의 경우 300%를 상한으로 합니다." }
        },
        {
          "@type": "Question",
          "name": "1세대 1주택자 세액공제에는 어떤 것이 있나요?",
          "acceptedAnswer": { "@type": "Answer", "text": "1세대 1주택자는 고령자 공제(60세 이상 20%, 65세 이상 30%, 70세 이상 40%)와 장기보유 공제(5년 이상 20%, 10년 이상 40%, 15년 이상 50%)를 받을 수 있습니다. 두 공제를 합산한 최대 공제율은 80%입니다." }
        },
        {
          "@type": "Question",
          "name": "부부 공동명의 시 종부세는 어떻게 계산되나요?",
          "acceptedAnswer": { "@type": "Answer", "text": "부부 공동명의의 경우 각각의 지분에 해당하는 공시가격을 기준으로 인별 과세됩니다. 예를 들어 공시가 18억 원 주택을 부부 50:50으로 보유하면 각각 9억 원씩 계산되어 기본공제(9억 원) 이하가 되어 종부세가 부과되지 않을 수 있습니다. 다만, 1세대 1주택 특례(12억 공제 등)는 적용되지 않으므로 유불리를 비교해야 합니다." }
        }
      ]
    }
    </script>
</CalcLayout>

<script>
  // Helper functions
  function formatNumber(n: number): string {
    return n.toLocaleString('ko-KR')
  }

  function formatManWon(amount: number): string {
    const abs = Math.abs(Math.round(amount))
    const sign = amount < 0 ? '-' : ''
    const eok = Math.floor(abs / 100000000)
    const man = Math.floor((abs % 100000000) / 10000)
    const rem = abs % 10000
    let r = sign
    if (eok > 0) {
      r += formatNumber(eok) + '억'
      if (man > 0) r += ' ' + formatNumber(man) + '만'
      if (rem > 0) r += ' ' + formatNumber(rem)
      r += '원'
    } else if (man > 0) {
      r += formatNumber(man) + '만'
      if (rem > 0) r += ' ' + formatNumber(rem)
      r += '원'
    } else {
      r += formatNumber(abs) + '원'
    }
    return r
  }

  function setupNumberInput(el: HTMLInputElement | null) {
    if (!el) return
    el.addEventListener('input', function() {
      const raw = this.value.replace(/[^0-9]/g, '')
      this.value = raw ? parseInt(raw).toLocaleString('ko-KR') : ''
    })
  }

  function getVal(id: string): number {
    const el = document.getElementById(id) as HTMLInputElement | null
    if (!el) return 0
    return parseInt(el.value.replace(/,/g, '')) || 0
  }

  // Setup
  setupNumberInput(document.getElementById('totalAssessedValue') as HTMLInputElement)

  const form = document.getElementById('calc-form') as HTMLFormElement
  const errorMsg = document.getElementById('error-msg') as HTMLDivElement
  const results = document.getElementById('results') as HTMLDivElement
  const exemptMsg = document.getElementById('exempt-msg') as HTMLDivElement
  const deductionSection = document.getElementById('deduction-section') as HTMLDivElement
  const ageField = document.getElementById('age-field') as HTMLDivElement
  const holdingField = document.getElementById('holding-field') as HTMLDivElement
  const isSingleHomeOwnerCheckbox = document.getElementById('isSingleHomeOwner') as HTMLInputElement

  // Toggle additional fields
  isSingleHomeOwnerCheckbox?.addEventListener('change', function() {
    if (this.checked) {
      ageField.classList.remove('hidden')
      holdingField.classList.remove('hidden')
    } else {
      ageField.classList.add('hidden')
      holdingField.classList.add('hidden')
    }
  })

  form?.addEventListener('submit', (e) => {
    e.preventDefault()

    // Hide all messages
    errorMsg.classList.add('hidden')
    results.classList.add('hidden')
    exemptMsg.classList.add('hidden')
    deductionSection.classList.add('hidden')

    // Get inputs
    const totalAssessedValue = getVal('totalAssessedValue')
    const isSingleHomeOwner = isSingleHomeOwnerCheckbox?.checked || false
    const ownerAge = parseInt((document.getElementById('ownerAge') as HTMLInputElement)?.value || '0')
    const holdingYears = parseFloat((document.getElementById('holdingYears') as HTMLInputElement)?.value || '0')

    // Validation
    if (totalAssessedValue <= 0) {
      errorMsg.querySelector('p')!.textContent = '주택 공시가격을 입력해주세요.'
      errorMsg.classList.remove('hidden')
      return
    }

    // Basic deduction
    const deduction = isSingleHomeOwner ? 1200000000 : 900000000

    // Check if exempt
    if (totalAssessedValue <= deduction) {
      const msg = `공시가격 ${formatManWon(totalAssessedValue)}이(가) 기본공제액 ${formatManWon(deduction)} 이하입니다.`
      exemptMsg.querySelector('p')!.textContent = msg
      exemptMsg.classList.remove('hidden')
      return
    }

    // Calculate tax base
    const taxBase = Math.max(0, (totalAssessedValue - deduction) * 0.6)

    // Tax brackets
    const brackets = [
      { min: 0, max: 300000000, rate: 0.005, deduction: 0 },
      { min: 300000000, max: 600000000, rate: 0.007, deduction: 600000 },
      { min: 600000000, max: 1200000000, rate: 0.01, deduction: 2400000 },
      { min: 1200000000, max: 2500000000, rate: 0.013, deduction: 6000000 },
      { min: 2500000000, max: 5000000000, rate: 0.015, deduction: 11000000 },
      { min: 5000000000, max: 9400000000, rate: 0.02, deduction: 36000000 },
      { min: 9400000000, max: Infinity, rate: 0.027, deduction: 101800000 },
    ]

    let appliedRate = 0
    let appliedDeduction = 0

    for (const bracket of brackets) {
      if (taxBase > bracket.min && taxBase <= bracket.max) {
        appliedRate = bracket.rate
        appliedDeduction = bracket.deduction
        break
      }
    }

    let calculatedTax = Math.round(taxBase * appliedRate - appliedDeduction)

    // Age deduction (only for single home owner)
    let ageDeductionRate = 0
    if (isSingleHomeOwner) {
      if (ownerAge >= 70) {
        ageDeductionRate = 0.40
      } else if (ownerAge >= 65) {
        ageDeductionRate = 0.30
      } else if (ownerAge >= 60) {
        ageDeductionRate = 0.20
      }
    }

    // Holding deduction (only for single home owner)
    let holdingDeductionRate = 0
    if (isSingleHomeOwner) {
      if (holdingYears >= 15) {
        holdingDeductionRate = 0.50
      } else if (holdingYears >= 10) {
        holdingDeductionRate = 0.40
      } else if (holdingYears >= 5) {
        holdingDeductionRate = 0.20
      }
    }

    // Combined deduction (max 80%)
    const totalDeductionRate = Math.min(ageDeductionRate + holdingDeductionRate, 0.80)
    const deductionAmount = Math.round(calculatedTax * totalDeductionRate)
    const comprehensiveTax = calculatedTax - deductionAmount

    // Local education tax
    const localEducationTax = Math.round(comprehensiveTax * 0.2)
    const totalTax = comprehensiveTax + localEducationTax

    // Effective rate
    const effectiveRate = totalAssessedValue > 0 ? (totalTax / totalAssessedValue * 100).toFixed(3) : '0.000'

    // Display results
    const totalTaxEl = document.getElementById('total-tax')
    const effectiveRateEl = document.getElementById('effective-rate')
    const basicDeductionEl = document.getElementById('basic-deduction')
    const taxBaseEl = document.getElementById('tax-base')
    const calculatedTaxEl = document.getElementById('calculated-tax')
    const comprehensiveTaxEl = document.getElementById('comprehensive-tax')
    const localEducationTaxEl = document.getElementById('local-education-tax')

    if (totalTaxEl) totalTaxEl.textContent = formatManWon(totalTax)
    if (effectiveRateEl) effectiveRateEl.textContent = effectiveRate + '%'
    if (basicDeductionEl) basicDeductionEl.textContent = formatManWon(deduction)
    if (taxBaseEl) taxBaseEl.textContent = formatManWon(taxBase)
    if (calculatedTaxEl) calculatedTaxEl.textContent = formatManWon(calculatedTax)
    if (comprehensiveTaxEl) comprehensiveTaxEl.textContent = formatManWon(comprehensiveTax)
    if (localEducationTaxEl) localEducationTaxEl.textContent = formatManWon(localEducationTax)

    // Show deduction section if applicable
    if (isSingleHomeOwner && totalDeductionRate > 0) {
      deductionSection.classList.remove('hidden')
      const ageDeductionRateEl = document.getElementById('age-deduction-rate')
      const holdingDeductionRateEl = document.getElementById('holding-deduction-rate')
      const totalDeductionRateEl = document.getElementById('total-deduction-rate')
      const deductionAmountEl = document.getElementById('deduction-amount')

      if (ageDeductionRateEl) ageDeductionRateEl.textContent = (ageDeductionRate * 100).toFixed(0) + '%'
      if (holdingDeductionRateEl) holdingDeductionRateEl.textContent = (holdingDeductionRate * 100).toFixed(0) + '%'
      if (totalDeductionRateEl) totalDeductionRateEl.textContent = (totalDeductionRate * 100).toFixed(0) + '%'
      if (deductionAmountEl) deductionAmountEl.textContent = formatManWon(deductionAmount)
    }

    results.classList.remove('hidden')
  })
</script>
